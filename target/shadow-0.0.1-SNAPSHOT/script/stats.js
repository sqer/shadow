(function(){var f=YAHOO.lang,d=YAHOO.util.Dom,e=function(h,c,b,a){e.superclass.constructor.call(this,h,c,b,a);this.on("columnStatsChange",this._colStatsValueChange)};YAHOO.extend(e,YAHOO.widget.DataTable,{_colStatsTfoot:null,_colStatsCache:{},initAttributes:function(a){e.superclass.initAttributes.call(this,a);this.setAttributeConfig("columnStats",{value:{on:false,stats:[],pagedTotals:false},setter:function(c){var b=0;if(c.on!==true){return c}if(!f.isArray(c.stats)){c.stats=[c.stats]}if(c.pagedTotals===undefined){c.pagedTotals=false}for(b=c.stats.length-1;b>=0;b=b-1){if(f.isString(c.stats[b])){c.stats[b]={label:c.stats[b],fn:c.stats[b]}}if(!f.isFunction(YAHOO.util.Stats.prototype[c.stats[b].fn])&&!f.isFunction(c.stats[b].fn)){c.stats.splice(b,1)}}return c},method:function(b){this._colStatsRemoveEvents(b);if(b&&b.on&&b.on===true){this._colStatsAddEvents(b)}}})},colStatsRefresh:function(){this._colStatsDestroy();this._colStatsRender(true);this._colStatsRenderValues()},colStatsGetRecordSet:function(){return this._colStatsGetRecordSet()},_colStatsAddEvents:function(b){var a=this.get("paginator");this.on("renderEvent",this._colStatsRenderValues);this.on("initEvent",this._colStatsRender);this.on("columnHideEvent",this._colStatsColumnHide);this.on("columnShowEvent",this._colStatsColumnShow);this.on("columnInsertEvent",this._colStatsColumnInsert);this.on("columnRemoveEvent",this._colStatsColumnRemove);this.on("rowsAddEvent",this._colStatsRowsAdd);this.on("rowsDeleteEvent",this._colStatsRowsDelete);this.on("rowAddEvent",this._colStatsRowsAdd);this.on("rowDeleteEvent",this._colStatsRowsDelete);if(a){if(b.pagedTotals===true){a.on("changeRequest",this._colStatsPageChange,null,this);this.on("columnSortEvent",this._colStatsPageChange,null,this)}else{this.on("rowsAddEvent",this._colStatsRenderValues,undefined,this);this.on("rowsDeleteEvent",this._colStatsRenderValues);this.on("rowAddEvent",this._colStatsRenderValues,undefined,this);this.on("rowDeleteEvent",this._colStatsRenderValues)}}this.on("cellUpdateEvent",this._colStatsUpdate)},_colStatsRemoveEvents:function(){var a;this.removeListener("renderEvent",this._colStatsRenderValues);this.removeListener("initEvent",this._colStatsRender);this.removeListener("columnHideEvent",this._colStatsColumnHide);this.removeListener("columnShowEvent",this._colStatsColumnShow);this.removeListener("columnInsertEvent",this._colStatsColumnInsert);this.removeListener("columnRemoveEvent",this._colStatsColumnRemove);this.removeListener("rowsAddEvent",this._colStatsRowsAdd);this.removeListener("rowsDeleteEvent",this._colStatsRowsDelete);this.removeListener("rowAddEvent",this._colStatsRowsAdd);this.removeListener("rowDeleteEvent",this._colStatsRowsDelete);this.removeListener("rowsAddEvent",this._colStatsRenderValues,undefined,this);this.removeListener("rowsDeleteEvent",this._colStatsRenderValues);this.removeListener("rowAddEvent",this._colStatsRenderValues,undefined,this);this.removeListener("rowDeleteEvent",this._colStatsRenderValues);this.removeListener("cellUpdateEvent",this._colStatsUpdate);a=this.get("paginator");if(a){a.on("changeRequest",this._colStatsPageChange,null,this);this.on("columnSortEvent",this._colStatsPageChange)}},_colStatsValueChange:function(a){if(a.newValue.on===true){this._colStatsPageChange(true);this._colStatsRenderValues()}else{this._colStatsDestroy()}},_colStatsDestroy:function(){this._colStatsTfoot.parentNode.removeChild(this._colStatsTfoot);this._colStatsTfoot=null;this._colStatsCache={}},_colStatsPageChange:function(a){this._colStatsCache={};this._colStatsRender(a)},_colStatsRender:function(a){this._colStatsRenderTfoot(a);this._colStatsCalculateValues()},_colStatsRenderTfoot:function(a){var r,i,b,q,j=0,o=0,p,c;if(a===true&&this._colStatsTfoot){this._colStatsTfoot.parentNode.removeChild(this._colStatsTfoot);this._colStatsTfoot=null}if(this._colStatsTfoot===null){p=this.get("columnStats").stats;c=this.getColumnSet().keys;r=this.getTbodyEl().parentNode.createTFoot();for(;o<p.length;o=o+1){i=r.insertRow(-1);if(o===0){d.addClass(i,"yui-dt-first")}for(j=0;j<c.length;j=j+1){q=document.createElement("td");d.addClass(q,"yui-dt-colstat");d.addClass(q,"yui-dt-col-"+c[j].field);if(c[j].className!==undefined){d.addClass(q,c[j].className)}if(c[j].hidden===true){d.addClass(q,"yui-dt-hidden")}b=document.createElement("div");d.addClass(b,"yui-dt-liner");if(j===0){b.innerHTML=p[o].label}q.appendChild(b);i.appendChild(q)}r.appendChild(i)}this._colStatsTfoot=r}},_colStatsRenderValues:function(i){var x=d.getElementsByClassName("yui-dt-liner","div",this._colStatsTfoot),u=(i&&this.getColumn(i)?[this.getColumn(i)]:this.getColumnSet().keys),c=this.get("columnStats").stats,w=this._colStatsCache,j=0,v,r="",s,a=0,b=0,t;if(i!==undefined){j=u[0].getKeyIndex()}for(;b<c.length;b=b+1){for(a=j;a<u.length;a=a+1){t=(u.length*b)+a;v=c[b];if(!x[t]){continue}r="";if(a===0){r=v.label}else{if(w[u[a].field]!==undefined){s=w[u[a].field].stats;if(f.isString(v.fn)&&s[v.fn]!==undefined){r=(s[v.fn])()}else{if(f.isFunction(v.fn)){r=v.fn.call(this,s,w,u[a])}}}}if(a===0||(!f.isFunction(u[a].formatter)&&!f.isFunction(YAHOO.widget.DataTable.Formatter[u[a].formatter]))||u[a].columnStats!==true){x[t].innerHTML=r}else{if(f.isFunction(YAHOO.widget.DataTable.Formatter[u[a].formatter])){YAHOO.widget.DataTable.Formatter[u[a].formatter].call(this,x[t],null,u[a],r)}else{u[a].formatter.call(this,x[t],null,u[a],r)}}}}},_colStatsGetRecordSet:function(){var c=this.getRecordSet(),a,b;if(this.get("columnStats").pagedTotals===true){a=this.get("paginator");if(a){b=c.getRecords(a.getStartIndex(),a.getRowsPerPage());return b}}return c.getRecords()},_colStatsCalculateValues:function(c){var a=this._colStatsGetRecordSet(),j=(c&&this.getColumn(c))?[this.getColumn(c)]:this.getColumnSet().keys,o=0,n,b,i,p=(c?this._colStatsCache||{}:{});if(c&&p[j[0].field]!==undefined){p[j[0].field].stats=undefined}for(;o<a.length;o=o+1){for(n=0;n<j.length;n=n+1){if(j[n].columnStats!==true){continue}b=a[o].getData(j[n].field);i=j[n].field;if(f.isNumber(b)){if(p[i]===undefined||p[i].stats===undefined){p[i]={stats:new YAHOO.util.Stats()}}p[i].stats.addDataValue(b,false)}}}for(o in p){if(p.hasOwnProperty(o)&&p[o].stats){p[o].stats.sort()}}this._colStatsCache=p;return p},_colStatsUpdate:function(b){var j,l=this.getDataSource(),a,k,c;if(b.record&&b.column){j=b.column.key;k=l.parseField(j,b.record.getData(j));c=l.parseField(j,b.oldData);b.record.setData(j,k)}if(b.column.columnStats!==true){return}a=this._colStatsCache[j];if(a===undefined){a={stats:new YAHOO.util.Stats()}}a.stats.removeDataValue(c);a.stats.addDataValue(k);this._colStatsCache[j]=a;this._colStatsRenderValues();return},_colStatsColumnHide:function(a){return this._colStatsColumnShowHide(function(b){d.addClass(b,"yui-dt-hidden")},a.column.getKeyIndex())},_colStatsColumnShow:function(a){return this._colStatsColumnShowHide(function(b){d.removeClass(b,"yui-dt-hidden")},a.column.getKeyIndex())},_colStatsColumnShowHide:function(c,j){var m=d.getElementsBy(function(){return true},"tr",this._colStatsTfoot),n,i=0,a,b=(j?function(){a=a+1;return(a-1)===j}:function(){return true});for(;i<m.length;i=i+1){a=0;n=d.getElementsBy(b,"td",m[i],c)}return n},_colStatsColumnInsert:function(a){this._colStatsRenderTfoot(true);this._colStatsCalculateValues(a.column.key)},_colStatsColumnRemove:function(a){this._colStatsRenderTfoot(true);delete (this._colStatsCache[a.column.key])},_colStatsRowsAdd:function(a){this._colStatsRowsUpdate(a.records||[a.record],1)},_colStatsRowsDelete:function(a){this._colStatsRowsUpdate(f.isArray(a.oldData)?a.oldData:[a.oldData],-1)},_colStatsRowsUpdate:function(b,s){var a=0,c,q,r=this._colStatsCache,i=this.getDataSource(),p=this.get("paginator"),t=this.get("columnStats"),o;for(;a<b.length;a=a+1){if(f.isObject(b[a])&&!(b[a] instanceof YAHOO.widget.Record)){if(b[a]._oData){b[a]=new YAHOO.widget.Record(b[a]._oData)}else{b[a]=new YAHOO.widget.Record(b[a])}}c=b[a].getData();for(o in r){if(r.hasOwnProperty(o)){q=i.parseField(o,c[o]);b[a].setData(o,q);if(t.pagedTotals===false||(p&&this.getRecordIndex(b[a])<=(p.getPageRecords())[1])){if(f.isNumber(q)){if(s>0){r[o].stats.addDataValue(q)}else{r[o].stats.removeDataValue(q)}}}}}}}});YAHOO.namespace("LPLT");YAHOO.LPLT.DataTable=e}());